#!/bin/bash
version="0.0.1"

errorBanner="$(cat <<-EOF
error during command or command not found.
type ./shell help for help."
EOF
)"

helpMessage="$(cat <<-EOF
HELP
----

help:
shkv help

set value:
shkv set key value

EOF
)"

help () {
    echo "${helpMessage}"
    exit
}

#
# set key value
#
setVal () {
    local key="$1"
    local value="$2"

    echo "${value}" > "${store}/${key}"
}

#
# BODY
#
main () {
[ -z ${command} ] && command="help"
    store=${SHKV_STORE}
    if [ "${command}" != "help" ] && [ "${store}" = "" ]; then
        echo "aborted. target store absolute path should be pointed with SHKV_STORE environment variable"
        exit
    fi
    mkdir -p "${store}"

    # command wrappers (when a command name is bash expression...)
    case "${command}" in
        set) commandFunctionName="setVal";;
    esac

    echo "version: ${version}, command: ${command}"
    declare -F ${commandFunctionName} &> /dev/null && ${commandFunctionName} $@ || echo "${errorBanner}"
}

command="$1"
commandFunctionName="$1"
store=${SHKV_STORE}
cwd=$(pwd)

main ${@:2}
